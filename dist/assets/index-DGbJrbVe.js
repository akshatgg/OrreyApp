import*as a from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{OrbitControls as J}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/controls/OrbitControls.js";import{EffectComposer as Y}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/EffectComposer";import{SSAARenderPass as Z}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/SSAARenderPass.js";import{RenderPass as Q}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/RenderPass";import{ShaderPass as ee}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/ShaderPass.js";import{UnrealBloomPass as te}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/UnrealBloomPass";import{ColorCorrectionShader as se}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/shaders/ColorCorrectionShader.js";import{CSS2DObject as ne,CSS2DRenderer as oe}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/renderers/CSS2DRenderer.js";import{GUI as ie}from"https://cdn.skypack.dev/dat.gui";import{GLTFLoader as re}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";import k from"https://cdn.skypack.dev/gsap";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();class m{constructor(e,t,i,n,r,h,w,l,c){this.name=n,this.orbit=i,this.radius=h,this.mass=r,this.material=new a.MeshBasicMaterial({map:new a.TextureLoader().load(w)}),this.geometry=new a.SphereGeometry(h,50,50),this.sphere=new a.Mesh(this.geometry,this.material);const g=e.createElement("p");g.textContent=n;const x=new ne(g);this.sphere.add(x),t.add(this.sphere),this.v=l,this.orbitComplete=0,this.description=c}translate(e){this.sphere.translateX(e[0]),this.sphere.translateY(e[1]),this.sphere.translateZ(e[2])}getMesh(){return this.sphere}movePlanet(e){let t=new a.Vector3;this.orbit.getPoint(this.orbitComplete,t),this.pos=t,this.sphere.position.applyMatrix4(this.orbit.getLine().matrixWorld);const i=1/this.v;this.orbitComplete=(e*60-i*Math.floor(e*60/i))*this.v}get pos(){return this.sphere.position}set pos(e){this.sphere.position.copy(e)}}class f{constructor(e,t,i,n,r,h,w=0){this.path=new a.EllipseCurve(n,r,t,i,0,2*Math.PI,!1,w),this.path.arcLengthDivisions=8e3,this.points=this.path.getPoints(8e3);const l=new a.BufferGeometry().setFromPoints(this.points),c=new a.LineBasicMaterial({color:h});this.originalColor=h,this.orbitLine=new a.Line(l,c),this.orbitLine.rotateX(Math.PI/2+w),this.orbitLine.renderOrder=1e3,e.add(this.orbitLine)}getPoint(e,t){this.path.getPoint(e,t)}getLine(){return this.orbitLine}}class j{static getInstance(){return this.instance}constructor(e,t){j.instance=this;const h=1631e-8*4e3*3.5,w=40454e-9*4e3*3.5,l=42633e-9*4e3*3.5,c=22714e-9*4e3*3.5,g=47787e-8*4e3,x=40287e-8*4e3,u=17085e-8*4e3*2,P=1655e-7*4e3*2,S=1631e-8*4e3*3.5,o=40454e-9*4e3*3.5,L=42633e-9*4e3*3.5,C=22714e-9*4e3*3.5,T=22714e-9*4e3*3.5;this.planets=[],this.orbits=[],this.currentPosition=0,this.sun=new m(e,t,new f(t,0,0,0,0,0),"Sun",3.5*3.5*1.4*(4*Math.PI*1.86096*1.86096/3),1.86096,"resources/textures/sun_texture.jpg",0,"The star at the center of our solar system, the Sun is a massive ball of hot, glowing gas."),this.planets.push(new m(e,t,new f(t,3.87032,3.78731,1.59091,0,9662683,7*Math.PI/180),"Mercury",5.4*(4*Math.PI*h*h/3),h,"resources/textures/mercury_texture.jpg",8e-4,"The smallest planet in our solar system, Mercury is a rocky, barren world with extreme temperatures.")),this.planets.push(new m(e,t,new f(t,7.23262,7.23244,.09358,0,13468991,3.4*Math.PI/180),"Venus",5.2*(4*Math.PI*w*w/3),w,"resources/textures/venus_texture.jpg",65e-5,"Shrouded in thick clouds, Venus is a scorching hot planet with a thick atmosphere that traps heat.")),this.planets.push(new m(e,t,new f(t,10,9.9985,.33422,0,52945,0*Math.PI/180),"Earth",5.5*(4*Math.PI*l*l/3),l,"resources/textures/earth_texture.jpg",6e-4,"Our home planet, Earth is a terrestrial world with a diverse range of environments and life forms.")),this.planets.push(new m(e,t,new f(t,15.2406,15.17315,2.8475,0,16736839,1.8*Math.PI/180),"Mars",3.9*(4*Math.PI*c*c/3),c,"resources/textures/mars_texture.jpg",5e-4,"A rocky, barren world with a thin atmosphere, Mars is a potential candidate for supporting life.")),this.planets.push(new m(e,t,new f(t,52.0387,51.97625,5.0668,0,16752762,1.3*Math.PI/180),"Jupiter",1.3*(4*Math.PI*3.5*3.5*g*g/3),g,"resources/textures/jupiter_texture.jpg",25e-5,"The largest planet in our solar system, Jupiter is a gas giant with massive storms and a strong magnetic field.")),this.planets.push(new m(e,t,new f(t,95.72526,95.5957,9.9532,0,16768685,2.5*Math.PI/180),"Saturn",.7*(4*Math.PI*3.5*3.5*x*x/3),x,"resources/textures/saturn_texture.jpg",2e-4,"Another gas giant, Saturn is known for its stunning ring system and diverse moons.")),this.planets.push(new m(e,t,new f(t,191.6477,191.4359,17.9612,0,8900346,.8*Math.PI/180),"Uranus",1.3*(4*Math.PI*3.5*3.5*u*u/12),u,"resources/textures/uranus_texture.jpg",15e-5,"An icy gas giant with a tilted axis, Uranus has a thin atmosphere and a system of rings and moons.")),this.planets.push(new m(e,t,new f(t,300.0001,299.7553,28.0462,0,4620980,1.8*Math.PI/180),"Neptune",1.2*(4*Math.PI*3.5*3.5*P*P/12),P,"resources/textures/neptune_texture.jpg",1e-4,"The farthest planet from the Sun, Neptune is a cold, icy world with strong winds and a few small moons.")),this.planets.push(new m(e,t,new f(t,27.658,27.5737,2.1573,0,11119017,10.587*Math.PI/180),"Ceres",1,S,"resources/textures/ceres_texture.jpg",28e-5,"The largest object in the asteroid belt, Ceres is a dwarf planet with a surface covered in craters and a possible subsurface ocean.")),this.planets.push(new m(e,t,new f(t,394.821,382.4027,98.2433,0,11119017,17.15*Math.PI/180),"Pluto",1,o,"resources/textures/pluto_texture.jpg",9e-5,"A dwarf planet in the Kuiper Belt, Pluto has a highly eccentric orbit and a surface composed of nitrogen ice.")),this.planets.push(new m(e,t,new f(t,433.4,425.5888,81.9126,0,11119017,28.19*Math.PI/180),"Haumea",1,C,"resources/textures/haumea_texture.jpg",85e-6,"An irregularly shaped dwarf planet in the Kuiper Belt, Haumea has a highly eccentric orbit and a surface composed of water ice.")),this.planets.push(new m(e,t,new f(t,-457.9,-452.07486,-72.8,0,11119017,28.96*Math.PI/180),"Makemake",1,L,"resources/textures/makemake_texture.jpg",82e-6,"A dwarf planet in the Kuiper Belt, Makemake has a highly inclined orbit and a surface composed of methane and ethane ices.")),this.planets.push(new m(e,t,new f(t,676.7,607.086,298.945,0,11119017,-44.187*Math.PI/180),"Eris",1,T,"resources/textures/eris_texture.jpg",8e-5,"A dwarf planet in the Kuiper Belt, Eris is slightly larger than Pluto and has a highly eccentric orbit."))}getPlanets(){return this.planets}getAndLogPlanetDescriptionByName(e){const t=this.planets.find(n=>n.name===e),i=t?t.description:"Planet not found.";return console.log(i),i}move(e){for(let t=0;t<this.planets.length;t++)this.planets[t].movePlanet(e)}}typewriterText;class ae{constructor(e,t,i,n,r){this.resetPos=n,this.resetVel=r,this.velocity=e,this.acc=t,this.scale=i,this.object=null,this.view_target=new a.Object3D,this.view_follow=new a.Object3D}set scl(e){this.scale=e,this.object.scale.set(this.scale,this.scale,this.scale)}get scl(){return this.scale}async loadModel(e,t){const n=await new re().loadAsync(t);this.object=n.scene,this.object.scale.set(this.scale,this.scale,this.scale),e.add(this.object)}get pos(){return this.object.position}set pos(e){this.object.position.x=e.x,this.object.position.y=e.y,this.object.position.z=e.z}get vel(){return this.velocity}set vel(e){this.velocity.x=e.x,this.velocity.y=e.y,this.velocity.z=e.z}}class le{constructor(e,t,i){this.size=100,this.points=[],this.lineGeometry=new a.BufferGeometry().setFromPoints(this.points);const n=new a.LineBasicMaterial({color:i}),r=new a.Line(this.lineGeometry,n);e.add(r)}reset(){this.points=[],this.lineGeometry.setFromPoints(this.points)}add(e){this.points.length>=this.size&&this.points.splice(0,1),this.points.push(e),this.lineGeometry.setFromPoints(this.points)}}var _=!1;function ce(){const s=new oe;return s.setSize(window.innerWidth,window.innerHeight),s.domElement.style.position="absolute",s.domElement.style.top="0px",s.domElement.style.pointerEvents="none",s.domElement.style.fontSize=1e4,s.domElement.style.color="LightGrey",document.body.appendChild(s.domElement),s}function ue(s,e,t){const i={threshold:.1,strength:.3,radius:.1,exposure:.01},n=new Q(s,e);n.clearAlpha=0;const r=new Z(s,e),h=new te(new a.Vector2(window.innerWidth,window.innerHeight),1.5,.4,.85);h.threshold=i.threshold,h.strength=i.strength,h.radius=i.radius,h.exposure=i.exposure;const w=new ee(se),l=new Y(t);r.sampleLevel=0,l.addPass(n),l.addPass(w),l.addPass(r),l.addPass(h);const c=new a.CubeTextureLoader;return s.background=c.load(["resources/textures/stars_skybox.jpg","resources/textures/stars_skybox.jpg","resources/textures/stars_skybox.jpg","resources/textures/stars_skybox.jpg","resources/textures/stars_skybox.jpg","resources/textures/stars_skybox.jpg"]),l}function de(){new a.Layers().set(1);const t=new a.WebGLRenderer;document.querySelector("#gameCanvas").appendChild(t.domElement),t.setSize(window.innerWidth,window.innerHeight),t.setPixelRatio(window.devicePixelRatio),document.body.appendChild(t.domElement);const i=document.getElementById("gui_container"),n=new ie({autoPlace:!1});return n.domElement.id="gui",i.appendChild(n.domElement),[t,n]}function he(s,e,t,i){s.position.x=24.375955763295476,s.position.y=6.096897081203575,s.position.z=19.341372778210438,e.minDistance=t.radius*5,e.enablePan=!1,e.listenToKeyEvents(window),e.enableDamping=!0,e.dampingFactor=.1,e.maxDistance=2e3,e.target=i.pos,e.update()}const pe=function(s,e,t,i,n){for(const r of e)s.acc.add(r.pos.clone().sub(s.pos).normalize().multiplyScalar(t*r.mass/s.pos.distanceToSquared(r.pos)));s.vel.add(s.acc.clone().multiplyScalar(n)),s.pos.add(s.vel.clone().multiplyScalar(n));for(const r of e)s.pos.distanceToSquared(r.pos)<=r.radius*r.radius&&(i.vel=0,s.acc=new a.Vector3(0,0,0),s.vel=new a.Vector3(0,0,0),s.pos=r.pos.clone().add(r.pos.clone().sub(s.pos).normalize().multiplyScalar(-r.radius)))},D=function(s,e){e.position.copy(s.pos.clone()),e.setDirection(s.vel.clone().normalize()),e.setLength(s.vel.clone().length())},me=async function(){const s={gravityConstant:1,preset:[10.246809049864057,1.1937240000000011,4.896345408993087,0,-.1,0,-1]},e={overviewMode:!0,travelModeRunning:!1,changeCamera:!1,prevMode:!0,activateGalatic:function(){this.overviewMode=!0},activateTerrestrial:function(){this.overviewMode=!1}},t={time:0,vel:1,lastVel:1,simInitTime:0},i=new a.Scene,n=new a.PerspectiveCamera(40,window.innerWidth/window.innerHeight,.01,3e3),[r,h]=de(),w=ue(i,n,r),l=new j(document,i),c=new J(n,r.domElement),g=ce(),x=new a.Vector2;var u=l.planets[2],P=2,S="";he(n,c,l.sun,l.planets[2]);const o=new ae(new a.Vector3(0,0,0),new a.Vector3(0,-.1,0),.06,new a.Vector3(0,0,0),new a.Vector3(0,-.1,0));o.vel=o.resetVel.clone(),await o.loadModel(i,"resources/satellite/scene.gltf");const L=new le(i,100,16777215);var C=new a.ArrowHelper(o.vel.clone().normalize(),o.pos.clone(),o.vel.clone().length()/10,16711680);i.add(C),e.activateGalatic=function(){S="",k.to(n.position,{x:24.375955763295476,y:6.096897081203575,z:19.341372778210438,duration:1.5,onUpdate:function(){n.lookAt(l.sun),E()}}),c.target=l.sun.pos,c.update(),t.vel=1,this.overviewMode=!0};const T=function(){c.target=l.planets[2].pos,c.maxDistance=l.planets[2].radius*10,c.minDistance=l.planets[2].radius*10,c.update(),e.changeCamera=!1,e.travelModeRunning=!1,L.reset(),typeof s.preset=="string"&&(s.preset=s.preset.replace("[","").replace("]","").split(",").map(Number));var d=!1;s.preset[6]>0?(d=!0,t.time=s.preset[6]):t.time=t.simInitTime,_&&(o.resetVel.x=s.preset[3],o.resetVel.y=s.preset[4],o.resetVel.z=s.preset[5],d&&(o.resetPos.x=s.preset[0],o.resetPos.y=s.preset[1],o.resetPos.z=s.preset[2])),o.vel=o.resetVel.clone(),o.pos=o.resetPos.clone(),o.acc=new a.Vector3(0,0,0),_=!1},R={resetSat:function(){T()},run:function(){e.travelModeRunning||(o.resetVel=o.vel.clone(),e.travelModeRunning=!0,t.vel=1,console.log(`[${o.pos.x}, ${o.pos.y}, ${o.pos.z}, ${o.vel.x}, ${o.vel.y}, ${o.vel.z}, ${t.time}]`))},satCam:function(){e.changeCamera=!0},earthCam:function(){e.changeCamera=!1}},V=h.addFolder("Missions");V.open(),V.add(e,"activateGalatic").name("Overview Mode"),V.add(e,"activateTerrestrial").name("Galatic Travel");const I=h.addFolder("Time Settings");I.open(),I.add(t,"time",0,1e3,.01).name("time").listen(),I.add(t,"vel",0,5,.01).name("velocity").listen();const v=h.addFolder("Controls");v.hide(),v.add(R,"run").name("Launch"),v.add(R,"resetSat").name("Reset"),v.add(R,"satCam").name("Switch to Satellite View"),v.add(R,"earthCam").name("Switch to Earth View"),v.add(s,"preset",{Default:[3.2328387056557553,1.1937240000000022,9.85211694139966,0,5.878500000000001,0,6.2116785000000005],"Pass By Jupiter":[-2.021128339438988,1.193724000000002,9.347612864810039,27.2562,9.9802,9.472100000000001,8.559918199999997],"GA on Saturn":[11.526917894518315,1.193724,-.14323023733115978,50,7.4019,4.0174,83.27830549999999],"Crash with Mars":[-4.752302894710143,1.1937240000000018,7.7807668487346024,-34.3474,-3.3456,-29.180300000000003,482.17783999999915],"Crash with Mercury":[-7.397484455156295,1.193723999999999,-4.50894958182004,48.861900000000006,-12.905000000000001,50,571.5294155000013],"GA on Uranus":[-2.057544383162217,1.193724000000002,9.333709430501823,-25.703400000000002,8.5645,75,703.0350093900004],"Double GA":[11.329370589492553,1.1937240000000005,1.9826389707195744,75,-1.5889,-.31970000000000004,1000.9074545000001],"Crash with Saturn":[6.574269213901129,1.193724000000002,8.632047447275971,75,11.1029,35.217400000000005,1004.6308958400011],"GAn Ceres":[10.96407028527316,1.1937240000000007,3.310020108511075,12.4213,22.6017,5.6344,1.5167150000000218]}).onFinishChange(function(){_=!0,R.resetSat()}).name("Presets");const z=v.addFolder("Try it yourself");z.add(o.vel,"x",-75,75,1e-4).name("Velocity X").listen(),z.add(o.vel,"y",-75,75,1e-4).name("Velocity Y").listen(),z.add(o.vel,"z",-75,75,1e-4).name("Velocity Z").listen(),window.addEventListener("resize",U),document.onmousemove=F,document.onclick=N,document.onwheel=E,window.onblur=function(d){e.travelModeRunning=!1},window.onfocus=function(d){e.travelModeRunning=!0},document.addEventListener("keydown",d=>{d.key=="r"&&location.reload()},!1);const G=new a.Raycaster;i.add(new a.AmbientLight(16777215,5));const B=new a.PointLight(16777215,10,0,0);B.position.set(0,0,0),i.add(B);var O=0;function H(d){requestAnimationFrame(H),d*=5e-4;var p=d-O;p||(p=0,t.time=0),O=d,t.time+=t.vel*p,e.prevMode!=e.overviewMode&&(L.reset(),e.prevMode=e.overviewMode,e.overviewMode?(k.to(n.position,{x:24.375955763295476,y:6.096897081203575,z:19.341372778210438,duration:1.5,onUpdate:function(){n.lookAt(l.sun),E()}}),c.update(),I.show(),v.hide(),u=l.sun,document.onmousemove=F,document.onclick=N,document.onwheel=E):(u=l.planets[2],o.resetPos=u.pos.clone().add(new a.Vector3(u.radius*2,u.radius*2,0)),s.preset[6]>0&&(t.time=s.preset[6],o.resetPos.x=s.preset[0],o.resetPos.y=s.preset[1],o.resetPos.z=s.preset[2],o.pos=o.resetPos.clone()),o.pos=o.resetPos.clone(),o.vel=o.resetVel,S=l.sun.name,W(12),D(o,C),o.scl=.06,e.travelModeRunning=!1,I.hide(),v.show(),v.open(),t.simInitTime=t.time,document.onmousemove=function(){},document.onclick=function(){},document.onwheel=function(){})),e.overviewMode?(o.resetPos=l.planets[2].pos.clone().add(new a.Vector3(l.planets[2].radius*2,l.planets[2].radius*2,0)),o.pos=o.resetPos.clone(),D(o,C)):(D(o,C),e.travelModeRunning?(pe(o,l.planets,s.gravityConstant,t,p),L.add(o.pos.clone()),c.target==o.pos&&(c.maxDistance=3,c.minDistance=3),c.target==u.pos&&(c.maxDistance=1e4,c.minDistance=1)):(t.lastVel=t.vel,t.vel=0,c.maxDistance=1e4,c.minDistance=.2),e.changeCamera?c.target=o.pos:c.target=l.planets[2].pos),t.time&&l.move(t.time),c.update(),g.render(i,n),w.render()}H(),console.log("hi");function U(){n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight),w.setSize(window.innerWidth,window.innerHeight),g.setSize(this.window.innerWidth,this.window.innerHeight)}function F(d){x.x=d.offsetX/window.innerWidth*2-1,x.y=-(d.offsetY/window.innerHeight)*2+1,G.setFromCamera(x,n);const p=G.ray;var y=1e6;u=null;for(const M of l.getPlanets()){const A=p.distanceSqToPoint(M.pos);A<y&&A<P?(u=M,y=A):(M.orbit.orbitLine.material.color.set(new a.Color(M.orbit.originalColor)),M.orbit.orbitLine.material.needsUpdate=!0,g.domElement.style.color="LightGrey")}const b=p.distanceSqToPoint(l.sun.pos);b<y&&b<P?(u=l.sun,y=b):g.domElement.style.color="LightGrey",u!=null&&(u.orbit.orbitLine.material.color.set(new a.Color(16777215)),u.orbit.orbitLine.material.needsUpdate=!0,g.domElement.style.color="white")}function q(){console.log(u.name);const d=document.getElementById("targetname");d.innerHTML=u.name}function W(d){if(u!=null){if(u.name!="Sun"?(t.lastVel=t.vel,t.vel=0):t.lastVel!=0?t.vel=t.lastVel:t.vel=1,S!=u.name){c.target=u.pos,c.minDistance=u.radius*5,c.update();const p=u.pos.clone().add(n.position.clone().sub(u.pos).normalize().multiplyScalar(u.radius*d));k.to(n.position,{x:p.x,y:p.y,z:p.z,duration:1.5,onUpdate:function(){n.lookAt(u.pos),E()}}),c.update(),S=u.name}}else t.vel=t.vel,c.minDistance=0}function $(d,p){const y=document.getElementById("typewriterText");if(!y)return;y.innerHTML="";let b=0;window.speechSynthesis.cancel(),X(d);const M=setInterval(()=>{y.innerHTML+=d.charAt(b),b++,b>=d.length&&clearInterval(M)},p)}const K=j.getInstance();function X(d){const p=window.speechSynthesis,y=new SpeechSynthesisUtterance(d);y.lang="en-US",p.speak(y)}function N(){const d=K.getAndLogPlanetDescriptionByName(u.name);console.log("hi"),console.log(d),q(),$(d,50),W(3)}function E(){let d=n.position.clone(),p=c.target.clone();P=d.sub(p).length()*.1}};await me();
